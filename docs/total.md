# 分布式ID生成器
## 背景

伴随互联网的发展,无论分布式系统、还是存储都变得更复杂、数据量更大,这些都需要唯一的标识记录.简单举例,数据库原一张表时,通常使用表sequence递增方式,但分库分表后,自带的sequence无法满足,我们需要有一个算法或服务来满足唯一标识的生成. 

## ID-Generator

id-generator分布式ID生成器, 解决在分布式系统唯一性标识生成复杂、不统一的问题,如数据库分库分表数据唯一标识、业务流水号、链路跟踪标识等场景. 提供一站式部署, 稳定、高性能的ID生成系统.

### 功能介绍
+ 提供全局唯一ID序号；
+ 提供隔离增长序号，以唯一KEY为自增ID标识, 如数据库-表之间的自增id效果；
+ 支持自定义增长步长；
+ 支持固定前缀；
+ 支持固定位数；
+ 支持ID重置；
+ 支持Dubbo、Spring Cloud应用部署；
+ 支持Mybatis插件，可直接插入ID；
+ 支持try it,查看模拟ID效果
+ 支持页面配置，即时生效；

![](./img/list4.png)

### 设计与实现
ID-Generator采用业内比较常用内存处理的方式,应用独立部署,提供生成ID能力的服务.服务启动时,先从`存储`中获得ID生成规则和取值范围,再经过计算生成ID值暂时存至内存;其它应用通过参数key,调用ID服务接口,从内存获得ID值;服务`定时`检查内存剩余量,及时向内存补充ID值.

<img src="./img/id-generator-total.jpg" width="600"/>

#### 设计原则
+ 0成本接入,部署即可以使用
+ 操作简单,页面配置,即时生效
+ 功能丰富,不仅限于递增序列生成,同时支持各种流水号,带前缀,插入日期,定期重置等扩展功能
+ 性能稳定,节点无状态,可以根据流量扩容
+ 代码预留扩展, 易于持续集成


#### 实现方式
1. 
#### 扩展
#### 存储
#### 过程遇到的问题
0.ID规则中带日期,预先加载值内存,未使用完,获取到错误的ID,规则如:

+ 前缀${yyyy}${mm}${DD} 
+ 固定自增6位
+ 每天重置
+ 序列递增1
+ 内存500
+ 阈值100

|时间|值|当天剩余ID|
|:--:|:--:|:--:|
|T1|500|20200526000001 20200526000002...|
|T2|20200526000001 20200526000002 20200526000003...|

1.为简化配置及遵循SpringBoot规则,同时支持MySQL和Redis存储配置二选一

```yaml
---
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/idgenerator
    username: root
    password: root

#---
#spring:
#  redis:
#    host: 127.0.0.1
#    port: 6379
```
通过Debug发现,集成spring-boot-starter-data-redis依赖是否redis配置,都会初始化RedisTemplate.

2.控制台APP和ID生成器APP,同时依赖core模块(加载buffer和管理ID功能), 但为不浪费生成无用ID,控制台不加载buffer.

3.Mybatis插件,兼容Dubbo和Spring Cloud两种框架获取ID的实现.

4.选择获取ID时,触发事件通知,还是定时轮训方式向buffer中补充ID?


### 优点
1 使用最新技术
### 未来规划
